<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Underpass: data/threads.hh File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Underpass
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_472fafaf0f039b9e6b043966c1ef7dbf.html">data</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">threads.hh File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Threads for monitoring/synchronizing various data sources:  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;future&gt;</code><br />
<code>#include &lt;iostream&gt;</code><br />
<code>#include &lt;pqxx/pqxx&gt;</code><br />
<code>#include &lt;string&gt;</code><br />
<code>#include &lt;vector&gt;</code><br />
<code>#include &lt;condition_variable&gt;</code><br />
<code>#include &lt;mutex&gt;</code><br />
<code>#include &lt;ogr_geometry.h&gt;</code><br />
<code>#include &lt;thread&gt;</code><br />
<code>#include &quot;boost/date_time/posix_time/posix_time.hpp&quot;</code><br />
<code>#include &lt;boost/date_time.hpp&gt;</code><br />
<code>#include &lt;boost/asio/connect.hpp&gt;</code><br />
<code>#include &lt;boost/asio/ip/tcp.hpp&gt;</code><br />
<code>#include &lt;boost/asio/ssl/error.hpp&gt;</code><br />
<code>#include &lt;boost/asio/ssl/stream.hpp&gt;</code><br />
<code>#include &lt;boost/beast/core.hpp&gt;</code><br />
<code>#include &lt;boost/beast/http.hpp&gt;</code><br />
<code>#include &lt;boost/beast/http/parser.hpp&gt;</code><br />
<code>#include &lt;boost/beast/version.hpp&gt;</code><br />
<code>#include &quot;<a class="el" href="osmstats_8hh_source.html">osmstats/osmstats.hh</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="replication_8hh_source.html">osmstats/replication.hh</a>&quot;</code><br />
<code>#include &quot;validate/validate.hh&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for threads.hh:</div>
<div class="dyncontent">
<div class="center"><img src="threads_8hh__incl.png" border="0" usemap="#adata_2threads_8hh" alt=""/></div>
<map name="adata_2threads_8hh" id="adata_2threads_8hh">
<area shape="rect" title="Threads for monitoring/synchronizing various data sources:" alt="" coords="2288,5,2399,32"/>
<area shape="rect" title=" " alt="" coords="5,80,60,107"/>
<area shape="rect" title=" " alt="" coords="1203,326,1275,353"/>
<area shape="rect" title=" " alt="" coords="389,244,468,271"/>
<area shape="rect" title=" " alt="" coords="1124,326,1179,353"/>
<area shape="rect" title=" " alt="" coords="1875,326,1934,353"/>
<area shape="rect" title=" " alt="" coords="2968,80,3095,107"/>
<area shape="rect" title=" " alt="" coords="2100,162,2157,189"/>
<area shape="rect" title=" " alt="" coords="1619,244,1729,271"/>
<area shape="rect" title=" " alt="" coords="2182,162,2241,189"/>
<area shape="rect" title=" " alt="" coords="2158,319,2307,360"/>
<area shape="rect" title=" " alt="" coords="2441,326,2579,353"/>
<area shape="rect" title=" " alt="" coords="2265,162,2421,189"/>
<area shape="rect" title=" " alt="" coords="3900,162,4043,189"/>
<area shape="rect" title=" " alt="" coords="4067,162,4225,189"/>
<area shape="rect" title=" " alt="" coords="4249,162,4419,189"/>
<area shape="rect" title=" " alt="" coords="3119,80,3261,107"/>
<area shape="rect" title=" " alt="" coords="3285,80,3425,107"/>
<area shape="rect" title=" " alt="" coords="3449,80,3629,107"/>
<area shape="rect" title=" " alt="" coords="3654,80,3814,107"/>
<area shape="rect" href="osmstats_8hh.html" title="This file is used to work with the OSM Stats database." alt="" coords="939,80,1089,107"/>
<area shape="rect" title=" " alt="" coords="1461,244,1594,271"/>
<area shape="rect" href="replication_8hh.html" title="This class downloads replication files, and adds them to the database." alt="" coords="2584,80,2740,107"/>
<area shape="rect" title=" " alt="" coords="466,162,541,189"/>
<area shape="rect" title=" " alt="" coords="989,244,1039,271"/>
<area shape="rect" title=" " alt="" coords="1064,244,1132,271"/>
<area shape="rect" href="pq_8hh.html" title="Pq for monitoring the OSM planet server for replication files." alt="" coords="309,162,391,189"/>
<area shape="rect" href="tmdefs_8hh_source.html" title=" " alt="" coords="544,244,660,271"/>
<area shape="rect" href="tmusers_8hh_source.html" title=" " alt="" coords="739,162,862,189"/>
<area shape="rect" href="changeset_8hh.html" title="The file is used for processing changeset files." alt="" coords="1715,162,1873,189"/>
<area shape="rect" href="osmchange_8hh.html" title="This file parses a change file in the OsmChange format." alt="" coords="1240,162,1404,189"/>
<area shape="rect" title=" " alt="" coords="1753,244,1792,271"/>
<area shape="rect" title=" " alt="" coords="2129,244,2176,271"/>
<area shape="rect" href="osmobjects_8hh.html" title="Data structures for OSM objects." alt="" coords="1919,244,2053,271"/>
<area shape="rect" href="timer_8hh.html" title="Implement a timer for performance testing." alt="" coords="2404,244,2472,271"/>
<area shape="rect" title=" " alt="" coords="1959,326,2093,353"/>
<area shape="rect" title=" " alt="" coords="1520,326,1652,353"/>
<area shape="rect" title=" " alt="" coords="2350,326,2417,353"/>
<area shape="rect" title=" " alt="" coords="2699,162,2779,189"/>
<area shape="rect" title=" " alt="" coords="2804,162,2864,189"/>
<area shape="rect" title=" " alt="" coords="2888,162,2959,189"/>
<area shape="rect" title=" " alt="" coords="2982,162,3147,189"/>
<area shape="rect" title=" " alt="" coords="3171,155,3310,196"/>
<area shape="rect" title=" " alt="" coords="3334,162,3473,189"/>
<area shape="rect" title=" " alt="" coords="3497,162,3627,189"/>
<area shape="rect" title=" " alt="" coords="3651,162,3825,189"/>
</map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="threads_8hh__dep__incl.png" border="0" usemap="#adata_2threads_8hhdep" alt=""/></div>
<map name="adata_2threads_8hhdep" id="adata_2threads_8hhdep">
<area shape="rect" title="Threads for monitoring/synchronizing various data sources:" alt="" coords="28,5,139,32"/>
<area shape="rect" href="replication_8hh.html" title="This class downloads replication files, and adds them to the database." alt="" coords="5,80,161,107"/>
<area shape="rect" href="underpass_8hh.html" title="Underpass for monitoring the OSM planet server for replication files." alt="" coords="19,155,147,181"/>
</map>
</div>
</div>
<p><a href="threads_8hh_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="typedef-members" name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a60a92ea513bd2f25705cdd673983c5a8"><td class="memItemLeft" align="right" valign="top"><a id="a60a92ea513bd2f25705cdd673983c5a8" name="a60a92ea513bd2f25705cdd673983c5a8"></a>
using&#160;</td><td class="memItemRight" valign="bottom"><b>tcp</b> = net::ip::tcp</td></tr>
<tr class="separator:a60a92ea513bd2f25705cdd673983c5a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a682dae5c70821d6a5261779edbb06d8f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="threads_8cc.html#a682dae5c70821d6a5261779edbb06d8f">threads::startStateThreads</a> (const std::string &amp;base, const std::string &amp;file)</td></tr>
<tr class="separator:a682dae5c70821d6a5261779edbb06d8f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad101491c3fe6a688c4f1dd6eeaaea6fc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="threads_8cc.html#ad101491c3fe6a688c4f1dd6eeaaea6fc">threads::startMonitor</a> (const <a class="el" href="classreplication_1_1RemoteURL.html">replication::RemoteURL</a> &amp;inr, const multipolygon_t &amp;poly, const std::string &amp;dburl)</td></tr>
<tr class="separator:ad101491c3fe6a688c4f1dd6eeaaea6fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a53ed6a264f7e68b955962b33024f5b3f"><td class="memItemLeft" align="right" valign="top"><a id="a53ed6a264f7e68b955962b33024f5b3f" name="a53ed6a264f7e68b955962b33024f5b3f"></a>
std::shared_ptr&lt; <a class="el" href="classreplication_1_1StateFile.html">replication::StateFile</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>threads::threadStateFile</b> (ssl::stream&lt; tcp::socket &gt; &amp;stream, const std::string &amp;file)</td></tr>
<tr class="memdesc:a53ed6a264f7e68b955962b33024f5b3f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Updates the states table in the Underpass database. <br /></td></tr>
<tr class="separator:a53ed6a264f7e68b955962b33024f5b3f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0b57ee6472b64b1f66b90e671a200fa8"><td class="memItemLeft" align="right" valign="top">std::shared_ptr&lt; <a class="el" href="classosmchange_1_1OsmChangeFile.html">osmchange::OsmChangeFile</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="threads_8cc.html#a0b57ee6472b64b1f66b90e671a200fa8">threads::threadOsmChange</a> (const <a class="el" href="classreplication_1_1RemoteURL.html">replication::RemoteURL</a> &amp;remote, const multipolygon_t &amp;poly, <a class="el" href="classosmstats_1_1QueryOSMStats.html">osmstats::QueryOSMStats</a> &amp;ostats, std::shared_ptr&lt; Validate &gt; &amp;plugin)</td></tr>
<tr class="separator:a0b57ee6472b64b1f66b90e671a200fa8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa948b1019860a6a508249924fd23b751"><td class="memItemLeft" align="right" valign="top">std::shared_ptr&lt; <a class="el" href="classchangeset_1_1ChangeSetFile.html">changeset::ChangeSetFile</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="threads_8cc.html#aa948b1019860a6a508249924fd23b751">threads::threadChangeSet</a> (const <a class="el" href="classreplication_1_1RemoteURL.html">replication::RemoteURL</a> &amp;remote, const multipolygon_t &amp;poly, <a class="el" href="classosmstats_1_1QueryOSMStats.html">osmstats::QueryOSMStats</a> &amp;ostats)</td></tr>
<tr class="separator:aa948b1019860a6a508249924fd23b751"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8048675cb3b9451a7b9b187a570cbd46"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="threads_8cc.html#a8048675cb3b9451a7b9b187a570cbd46">threads::threadStatistics</a> (const std::string &amp;database, ptime &amp;timestamp)</td></tr>
<tr class="separator:a8048675cb3b9451a7b9b187a570cbd46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:add8d616d7a0e96751115c3aa3e1aaefd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="threads_8hh.html#add8d616d7a0e96751115c3aa3e1aaefd">threads::threadOSM</a> (const std::string &amp;database, ptime &amp;timestamp)</td></tr>
<tr class="separator:add8d616d7a0e96751115c3aa3e1aaefd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae5515ff48379f42488d30974afe86d64"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="threads_8cc.html#ae5515ff48379f42488d30974afe86d64">threads::threadTMUsersSync</a> (std::atomic&lt; bool &gt; &amp;tmUserSyncIsActive, const std::string &amp;tmDbUrl, const std::string &amp;osmStatsDbUrl, long tmusersfrequency=-1)</td></tr>
<tr class="memdesc:ae5515ff48379f42488d30974afe86d64"><td class="mdescLeft">&#160;</td><td class="mdescRight">threadTMUsersSync starts a cron-like monitor task that synchronizes users from TM database.  <a href="threads_8cc.html#ae5515ff48379f42488d30974afe86d64">More...</a><br /></td></tr>
<tr class="separator:ae5515ff48379f42488d30974afe86d64"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >Threads for monitoring/synchronizing various data sources: </p>
<ul>
<li>OSM planet server for replication files.</li>
<li>TM users table DB</li>
</ul>
<p >These are the threads used to download and apply the replication files to a database. The thread monitors the OSM planet server for updated replication files. Another thread imports users data from TM database. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="ad101491c3fe6a688c4f1dd6eeaaea6fc" name="ad101491c3fe6a688c4f1dd6eeaaea6fc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad101491c3fe6a688c4f1dd6eeaaea6fc">&#9670;&nbsp;</a></span>startMonitor()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void threads::startMonitor </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classreplication_1_1RemoteURL.html">replication::RemoteURL</a> &amp;&#160;</td>
          <td class="paramname"><em>remote</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const multipolygon_t &amp;&#160;</td>
          <td class="paramname"><em>poly</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>dburl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >This monitors the planet server for new files of the specified type. It does a bulk download to catch up the database, then checks for the minutely change files and processes them. </p>

</div>
</div>
<a id="a682dae5c70821d6a5261779edbb06d8f" name="a682dae5c70821d6a5261779edbb06d8f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a682dae5c70821d6a5261779edbb06d8f">&#9670;&nbsp;</a></span>startStateThreads()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void threads::startStateThreads </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>base</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>file</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >This handler downloads state.txt files from planet, newest first, and then goes backwards in time. This is used to populate database tables with only newer data. </p>

</div>
</div>
<a id="aa948b1019860a6a508249924fd23b751" name="aa948b1019860a6a508249924fd23b751"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa948b1019860a6a508249924fd23b751">&#9670;&nbsp;</a></span>threadChangeSet()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::shared_ptr&lt; <a class="el" href="classchangeset_1_1ChangeSetFile.html">changeset::ChangeSetFile</a> &gt; threads::threadChangeSet </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classreplication_1_1RemoteURL.html">replication::RemoteURL</a> &amp;&#160;</td>
          <td class="paramname"><em>remote</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const multipolygon_t &amp;&#160;</td>
          <td class="paramname"><em>poly</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classosmstats_1_1QueryOSMStats.html">osmstats::QueryOSMStats</a> &amp;&#160;</td>
          <td class="paramname"><em>ostats</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >This updates several fields in the raw_changesets table, which are part of the changeset file, and don't need to be calculated. </p>

</div>
</div>
<a id="add8d616d7a0e96751115c3aa3e1aaefd" name="add8d616d7a0e96751115c3aa3e1aaefd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#add8d616d7a0e96751115c3aa3e1aaefd">&#9670;&nbsp;</a></span>threadOSM()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void threads::threadOSM </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>database</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ptime &amp;&#160;</td>
          <td class="paramname"><em>timestamp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >This updates an OSM database, which can be used for extracts and other validation. </p>

</div>
</div>
<a id="a0b57ee6472b64b1f66b90e671a200fa8" name="a0b57ee6472b64b1f66b90e671a200fa8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0b57ee6472b64b1f66b90e671a200fa8">&#9670;&nbsp;</a></span>threadOsmChange()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::shared_ptr&lt; <a class="el" href="classosmchange_1_1OsmChangeFile.html">osmchange::OsmChangeFile</a> &gt; threads::threadOsmChange </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classreplication_1_1RemoteURL.html">replication::RemoteURL</a> &amp;&#160;</td>
          <td class="paramname"><em>remote</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const multipolygon_t &amp;&#160;</td>
          <td class="paramname"><em>poly</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classosmstats_1_1QueryOSMStats.html">osmstats::QueryOSMStats</a> &amp;&#160;</td>
          <td class="paramname"><em>ostats</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::shared_ptr&lt; Validate &gt; &amp;&#160;</td>
          <td class="paramname"><em>plugin</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Updates the raw_hashtags, raw_users, and raw_changesets_countries tables from a changeset file </p>

</div>
</div>
<a id="a8048675cb3b9451a7b9b187a570cbd46" name="a8048675cb3b9451a7b9b187a570cbd46"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8048675cb3b9451a7b9b187a570cbd46">&#9670;&nbsp;</a></span>threadStatistics()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void threads::threadStatistics </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>database</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ptime &amp;&#160;</td>
          <td class="paramname"><em>timestamp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >This updates the calculated fields in the raw_changesets table, based on the data in the OSM stats database. These should be calculated by the OsmChange thread, but as changesets and osmchange files are on different timestamps, this looks for anything that got missed. </p>

</div>
</div>
<a id="ae5515ff48379f42488d30974afe86d64" name="ae5515ff48379f42488d30974afe86d64"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae5515ff48379f42488d30974afe86d64">&#9670;&nbsp;</a></span>threadTMUsersSync()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void threads::threadTMUsersSync </td>
          <td>(</td>
          <td class="paramtype">std::atomic&lt; bool &gt; &amp;&#160;</td>
          <td class="paramname"><em>tmUserSyncIsActive</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>tmDbUrl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>osmStatsDbUrl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>tmusersfrequency</em> = <code>-1</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>threadTMUsersSync starts a cron-like monitor task that synchronizes users from TM database. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tmUserSyncIsActive</td><td>reference to an atomic flag that will exit the loop when FALSE, this allows to abort the function fro client code. </td></tr>
    <tr><td class="paramname">tmDbUrl</td><td>the TM database connection string in the form HOST or USER:PASSSWORD@HOST/DATABASENAME </td></tr>
    <tr><td class="paramname">osmStatsDbUrlthe</td><td>OSMStats database connection string in the form HOST or USER:PASSSWORD@HOST/DATABASENAME </td></tr>
    <tr><td class="paramname">tmusersfrequency</td><td>TM user sync frequency in seconds (-1 -&gt; disabled, 0 -&gt; single shot, &gt; 0 -&gt; interval) </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2
</small></address>
</body>
</html>
