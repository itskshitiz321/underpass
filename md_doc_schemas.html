<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Underpass: Database Schemas</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Underpass
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Database Schemas </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >There are several database schemas used for OpenStreetMap data. The primary two used by most people working with OSM files are created by the two utility programs, <em>osm2pgsql</em> and <em>ogr2ogr</em>. Both work the same, and contain the same data, it's just organized differently. Underpass doesn't import into these database, as there are actively maintained tools for this already. These schemas are well-suited towards data extracts, and <a href="https://wiki.openstreetmap.org/wiki/Conflation">conflation</a> and <a href="https://labs.mapbox.com/mapping/validating-osm/">validation</a>.</p>
<h1><a class="anchor" id="autotoc_md38"></a>
osm2pgsql</h1>
<p ><a href="https://osm2pgsql.org/">Osm2pgsql</a> is the primary tool for importing OSM files. The <em>osm2pgsql</em> program can import a data file into postgres, but it doesn’t support updating the data. As it contains geospatial data, it’s a compact and easily queried schema. It lacks any knowledge of relations, which isn’t usually a problem unless you want to do deeper analysis of the data.</p>
<p >osm2pgsql has the ability to import <code>.osc</code> change files and update an existing database.</p>
<p >&#160;</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Table   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">planet_osm_line   </td><td class="markdownTableBodyNone">All of the ways that aren't a polygon    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">planet_osm_point   </td><td class="markdownTableBodyNone">All of the nodes    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">planet_osm_polygon   </td><td class="markdownTableBodyNone">All of the polygons    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">planet_osm_roads   </td><td class="markdownTableBodyNone">Unused currently    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">spatial_ref_sys   </td><td class="markdownTableBodyNone">Geospatial data for postgis   </td></tr>
</table>
<p >All of these tables have the same columns in the database. Any tag that doesn't fit one of these columns is stored in the *tags"
column. The tags column uses
&lt;a href="<a href="https://www.postgresqltutorial.com/postgresql-hstore/">https://www.postgresqltutorial.com/postgresql-hstore/</a>" &gt;hstore&lt;/a&gt;, which
can store additional keyword/value pairs. The columns are:
 osm_id, access, addr:housename, addr:housenumber, addr:interpolation,
 admin_level, aerialway, aeroway, amenity,  area, barrier, bicycle,
 brand, bridge, boundary, building, construction, covered, culvert,
 cutting, denomination, disused, embankment, foot, generator:source,
 harbour, highway, historic, horse, intermittent, junction, landuse,
 layer, leisure, lock, man_made, military, motorcar, name, natural,
 office, oneway, operator, place, population, power, power_source,
 public_transport, railway, ref, religion, route, service, shop
, sport, surface, toll, tourism, tower:type, tracktype, tunnel
, water, waterway, wetland, width, wood, z_order, way_area, tags, way

@section autotoc_md39 ogr2ogr

&lt;a href="<a href="https://www.osgeo.org/projects/gdal/">https://www.osgeo.org/projects/gdal/</a>" &gt;Ogr and GDAL&lt;/a&gt; are the basis for
many GIS projects, but has &lt;a href="<a href="https://gdal.org/drivers/vector/osm.html">https://gdal.org/drivers/vector/osm.html</a>"
 &gt;minimal OSM&lt;/a&gt; support. It can read
the OSM XML and PBF formats, and can import into a database. It uses a
different schema for each table.

osm2pgsql does not support updating from &lt;tt&gt;.osc&lt;/tt&gt; change files.

&amp;nbsp;

&lt;table class="markdownTable"&gt;
  &lt;tr class="markdownTableHead"&gt;    &lt;th class="markdownTableHeadNone"&gt; Table   </p>
<p >Description    </p>
<p >lines   </p>
<p >All of the single lines    </p>
<p >multilinestrings   </p>
<p >All of the multiple lines    </p>
<p >multipolygons   </p>
<p >All of the polygons    </p>
<p >other_relations   </p>
<p >More of the tags    </p>
<p >points   </p>
<p >All of the nodes    </p>
<p >spatial_ref_sys   </p>
<p >Geospatial data for postgis   </p>
<p ><a href="https://gdal.org/programs/ogr2ogr.html">ogr2ogr</a> uses a config file (<em>osmconf.ini</em>) to determine which fields in the OSM file get imported into which column. Any data not in one of these columns get put in the <em>other_tags</em> column. Other_tags is an hstore column, so contains multiple pairs of data. It is possible to modify the osmconf.ini file to have data that was going into the other_tags column go into it's own column.</p>
<p >The data columns of an ogr2ogr created database are:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Table   </th><th class="markdownTableHeadNone">Columns    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">multipolygons   </td><td class="markdownTableBodyNone">ogc_fid, osm_id, osm_way_id, name, type, aeroway, amenity, admin_level, barrier, boundary, building, craft, geological, historic, land_area, landuse, leisure, man_made, military, natural, office, place, shop, sport, tourism, other_tags, wkb_geometry    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">multilinestrings   </td><td class="markdownTableBodyNone">ogc_fid, osm_id, name, type, other_tags, wkb_geometry    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">lines   </td><td class="markdownTableBodyNone">ogc_fid, osm_id, name, highway, waterway, aerialway, barrier, man_made, z_order, other_tags, wkb_geometry   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md40"></a>
Example Queries</h1>
<p ><a href="https://en.wikipedia.org/wiki/SQL">SQL</a> is a powerful language for manipulating database data. </p><pre class="fragment"># Select all buildings
SELECT name,wkb_geometry FROM multipolygons WHERE building='yes';

# Count highways
SELECT COUNT(wkb_geometry) FROM multilinestrings WHERE highway is NOT NULL;

# Find bad highways
# SELECT * FROM multilinestrings WHERE other_tags-&gt;'surface'='bad';
</pre> <h1><a class="anchor" id="autotoc_md41"></a>
Core Database Schemas</h1>
<p >The primary one that operates the core servers uses <b>apidb</b>. There is a simplified version called <b>pgsnapshot</b>, which is more suited towards running ones own database. Both of these schemas are the only ones that can be updated with replication files. A replication file is the data of the actual change, and available with minutely, hourly, or daily updates.</p>
<p >Osmosis is commonly used for manipulating and importing data into these schemas. Although it has been unmaintained for several years. It’s written in Java, and as it uses temporary files on disk, an import can consume upwards of a terabyte.</p>
<p >Underpass can import a data file into the <em>pgsnapshot</em> schema without <em>osmosis</em>. It can also use <a class="el" href="md_doc_changefile.html">replication files</a> to update the database.</p>
<h2><a class="anchor" id="autotoc_md42"></a>
pgsnapshot</h2>
<p >The <em>pgsnapshot</em> schema is a more compact version of the main database. It contains geospatial information, and can be updated using replication files. It can also be easily queried to produce data extracts in OSM format. By default, it is not well suited to any data analysis that uses geospatial calculations since the nodes are stored separately from the ways. Underpass extends this schema by by adding a geometry column to the ways table.</p>
<p >&#160;</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Keyword   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">actions   </td><td class="markdownTableBodyNone">The action to do for a change,ie.. Create, delete, or modify    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">locked   </td><td class="markdownTableBodyNone">Locked when updating the database    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">nodes   </td><td class="markdownTableBodyNone">All the nodes    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">relation_members   </td><td class="markdownTableBodyNone">The memebers in a relation    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">relations   </td><td class="markdownTableBodyNone">A list of replations    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">replication_changes   </td><td class="markdownTableBodyNone">Counters on the changes in this replication file    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">schema_info   </td><td class="markdownTableBodyNone">Version number of this schema    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">spatial_ref_sys   </td><td class="markdownTableBodyNone">Geospatial data used by Postgis    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">sql_changes   </td><td class="markdownTableBodyNone">Used when applying a replication file    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">state   </td><td class="markdownTableBodyNone">The stat of the database update    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">users   </td><td class="markdownTableBodyNone">A list of user IDs and usernames    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">way_nodes   </td><td class="markdownTableBodyNone">A list of node references in a way    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ways   </td><td class="markdownTableBodyNone">A list of ways   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md43"></a>
apidb</h2>
<p >The <em>apidb</em> schema is the one that operates the core OpenStreetMap servers, and is usually access through a REST API.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Keyword   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">acls   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">active_storage_attachments   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">active_storage_blobs   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ar_internal_metadata   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">changeset_comments   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">changeset_tags   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">changesets   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">changesets_subscribers   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">client_applications   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">current_node_tags   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">current_nodes   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">current_relation_members   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">current_relation_tags   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">current_relations   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">current_way_nodes   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">current_way_tags   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">current_ways   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">delayed_jobs   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">diary_comments   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">diary_entries   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">diary_entry_subscriptions   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">friends   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">gps_points   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">gpx_file_tags   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">gpx_files   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">issue_comments   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">issues   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">languages   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">messages   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">node_tags   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">nodes   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">note_comments   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">notes   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">oauth_nonces   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">oauth_tokens   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">redactions   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">relation_members   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">relation_tags   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">relations   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">reports   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">schema_migrations   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">spatial_ref_sys   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">user_blocks   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">user_preferences   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">user_roles   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">user_tokens   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">users   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">way_nodes   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">way_tags   </td><td class="markdownTableBodyNone">tbd    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ways   </td><td class="markdownTableBodyNone">tbd   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md44"></a>
Schema Comparison</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Tool Language   </th><th class="markdownTableHeadNone">OSC Support   </th><th class="markdownTableHeadNone">Geometry in the main table    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">osm2pgsql   </td><td class="markdownTableBodyNone">C++   </td><td class="markdownTableBodyNone">yes   </td><td class="markdownTableBodyNone">yes    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ogr2ogr   </td><td class="markdownTableBodyNone">C++   </td><td class="markdownTableBodyNone">no   </td><td class="markdownTableBodyNone">yes    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">pgsnapshot   </td><td class="markdownTableBodyNone">&ndash;   </td><td class="markdownTableBodyNone">yes   </td><td class="markdownTableBodyNone">no   </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2
</small></address>
</body>
</html>
